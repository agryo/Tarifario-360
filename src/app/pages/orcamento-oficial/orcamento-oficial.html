<div class="max-w-1100 mx-auto p-1">
  <!-- T√≠tulo da p√°gina -->
  <div class="surface-card p-1 border-round text-center mb-3">
    <h1 class="text-2xl font-bold text-center">üìÑ Or√ßamento Oficial</h1>
  </div>

  <!-- √Årea de Configura√ß√£o -->
  <div class="surface-card p-3 border-round mb-3 border-2 border-primary">
    <div class="flex justify-content-between align-items-center mb-3">
      <h2 class="text-xl font-bold m-0">üìÑ Insira os dados</h2>
      <div class="flex gap-2">
        <p-button
          label="Salvar"
          icon="pi pi-save"
          styleClass="p-button-success"
          (click)="exportarOrcamento()"
        ></p-button>
        <p-button
          label="Abrir"
          icon="pi pi-folder-open"
          styleClass="p-button-secondary"
          (click)="fileInput.click()"
        ></p-button>
        <input
          #fileInput
          type="file"
          accept=".json"
          style="display: none"
          (change)="importarOrcamento($event)"
        />
        <p-button
          label="Voltar"
          icon="pi pi-arrow-left"
          styleClass="p-button-help"
          (click)="voltar()"
        ></p-button>
      </div>
    </div>

    <!-- Primeira linha: Cliente e Temporada -->
    <div class="grid">
      <div class="col-12 md:col-6">
        <div class="field">
          <label for="cliente">Empresa / Cliente</label>
          <input
            id="cliente"
            type="text"
            pInputText
            [(ngModel)]="cliente"
            (input)="calcularTotais()"
            class="w-full"
          />
        </div>
      </div>
      <div class="col-12 md:col-6">
        <div class="field">
          <label for="temporada">Temporada</label>
          <p-select
            id="temporada"
            [(ngModel)]="temporada"
            [options]="[
              { label: 'Autom√°tico (pela data)', value: 'auto' },
              { label: 'Baixa', value: 'baixa' },
              { label: 'Alta', value: 'alta' },
            ]"
            optionLabel="label"
            optionValue="value"
            styleClass="w-full"
            (onChange)="onTemporadaChange()"
          ></p-select>
        </div>
      </div>
    </div>

    <!-- Segunda linha: Datas e Horas -->
    <div class="grid">
      <div class="col-12 md:col-3">
        <div class="field">
          <label for="checkin">Check-in</label>
          <p-datepicker
            id="checkin"
            [(ngModel)]="dataCheckin"
            [showIcon]="true"
            dateFormat="dd/mm/yy"
            [minDate]="hoje"
            (onSelect)="onDataChange()"
            styleClass="w-full"
          ></p-datepicker>
        </div>
      </div>
      <div class="col-12 md:col-3">
        <div class="field">
          <label for="horaEntrada">Hora Entrada</label>
          <input
            id="horaEntrada"
            type="time"
            pInputText
            [(ngModel)]="horaEntrada"
            (change)="onDataChange()"
            class="w-full"
          />
        </div>
      </div>
      <div class="col-12 md:col-3">
        <div class="field">
          <label for="checkout">Check-out</label>
          <p-datepicker
            id="checkout"
            [(ngModel)]="dataCheckout"
            [showIcon]="true"
            dateFormat="dd/mm/yy"
            [minDate]="dataCheckin || hoje"
            (onSelect)="onDataChange()"
            styleClass="w-full"
          ></p-datepicker>
        </div>
      </div>
      <div class="col-12 md:col-3">
        <div class="field">
          <label for="horaSaida">Hora Sa√≠da</label>
          <input
            id="horaSaida"
            type="time"
            pInputText
            [(ngModel)]="horaSaida"
            (change)="onDataChange()"
            class="w-full"
          />
        </div>
      </div>
    </div>

    <!-- Tabela de Itens -->
    <p-table [value]="itens" styleClass="p-datatable-sm mt-3">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px">Qtd</th>
          <th>Acomoda√ß√£o</th>
          <th>H√≥spedes</th>
          <th style="width: 50px">Caf√©</th>
          <th style="width: 50px">Almo√ßo</th>
          <th style="width: 50px">Janta</th>
          <th style="width: 50px">Lanche</th>
          <th style="width: 50px"></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item let-i="rowIndex">
        <tr>
          <td>
            <p-inputNumber
              [(ngModel)]="item.quantidade"
              [min]="1"
              (onInput)="calcularItem(item)"
              [inputStyle]="{ width: '3rem' }"
              inputStyleClass="text-center"
            ></p-inputNumber>
          </td>
          <td>
            <p-select
              [(ngModel)]="item.categoriaId"
              [options]="categorias"
              optionLabel="nome"
              optionValue="id"
              styleClass="w-full"
              appendTo="body"
              (onChange)="onCategoriaChange(item)"
            ></p-select>
          </td>
          <td>
            <input
              pInputText
              [(ngModel)]="item.descricao"
              placeholder="Nome / cargo"
              class="w-full"
            />
          </td>
          <td class="text-center">
            <p-checkbox
              [(ngModel)]="item.comCafe"
              [binary]="true"
              (onChange)="calcularItem(item)"
            ></p-checkbox>
          </td>
          <td class="text-center">
            <p-checkbox
              [(ngModel)]="item.comAlmoco"
              [binary]="true"
              (onChange)="calcularItem(item)"
            ></p-checkbox>
          </td>
          <td class="text-center">
            <p-checkbox
              [(ngModel)]="item.comJanta"
              [binary]="true"
              (onChange)="calcularItem(item)"
            ></p-checkbox>
          </td>
          <td class="text-center">
            <p-checkbox
              [(ngModel)]="item.comLanche"
              [binary]="true"
              (onChange)="calcularItem(item)"
            ></p-checkbox>
          </td>
          <td>
            <p-button
              icon="pi pi-trash"
              styleClass="p-button-text p-button-danger p-button-sm"
              (click)="removerItem(i)"
            ></p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Bot√µes de a√ß√£o -->
    <div class="flex justify-content-between align-items-center mt-2">
      <p-button
        label="Adicionar UH"
        icon="pi pi-plus"
        styleClass="p-button-success p-button-sm"
        (click)="adicionarItem()"
      ></p-button>
      <div class="flex gap-2 flex-wrap">
        <p-button
          [label]="todosCom('comCafe') ? '‚òï Todos sem Caf√©' : '‚òï Todos com Caf√©'"
          styleClass="p-button-secondary p-button-sm"
          (click)="alternarTodos('comCafe')"
        ></p-button>
        <p-button
          [label]="todosCom('comAlmoco') ? 'üçΩÔ∏è Todos sem Almo√ßo' : 'üçΩÔ∏è Todos com Almo√ßo'"
          styleClass="p-button-secondary p-button-sm"
          (click)="alternarTodos('comAlmoco')"
        ></p-button>
        <p-button
          [label]="todosCom('comJanta') ? 'üçõ Todos sem Janta' : 'üçõ Todos com Janta'"
          styleClass="p-button-secondary p-button-sm"
          (click)="alternarTodos('comJanta')"
        ></p-button>
        <p-button
          [label]="todosCom('comLanche') ? 'ü•™ Todos sem Lanche' : 'ü•™ Todos com Lanche'"
          styleClass="p-button-secondary p-button-sm"
          (click)="alternarTodos('comLanche')"
        ></p-button>
      </div>
    </div>
  </div>

  <!-- Documento para Impress√£o -->
  <div class="surface-card p-3 border-round text-xs" id="documento-impressao">
    <!-- Cabe√ßalho com logo √† esquerda e informa√ß√µes √† direita -->
    <div
      class="flex align-items-center justify-content-between border-bottom-1 surface-border pb-2 mb-3"
    >
      <div class="logo-container">
        <img
          src="assets/img/logo_plaza.png"
          alt="Logo"
          style="margin: 10px auto 10px 80px; max-width: 90px"
        />
      </div>
      <div class="text-right" style="margin: 10px 80px 10px 10px">
        <h1 class="text-lg m-0 text-primary">A. M. da Silva Hotel Plaza</h1>
        <p class="text-sm m-0">CNPJ: 62.546.482/0001-3 | (84) 99180-1306</p>
        <p class="text-sm m-0">Rodovia RN 288, 91, Cruzeta - RN</p>
      </div>
    </div>

    <!-- T√≠tulo din√¢mico (configur√°vel) -->
    <div
      class="text-center font-bold text-primary mb-2 text-2xl uppercase"
      [innerHTML]="config.orcTitulo | placeholders: getPlaceholderVars()"
    ></div>

    <!-- Linha de proposta -->
    <h2 class="text-left">PROPOSTA DE HOSPEDAGEM: {{ cliente || 'Nome do Cliente' }}</h2>

    <!-- Se√ß√£o de Configura√ß√£o -->
    <div class="mt-3 text-sm">
      <h2
        [innerHTML]="config.orcConfigTitulo | placeholders: getPlaceholderVars()"
        id="docConfigTitulo"
      ></h2>
      <p
        [innerHTML]="config.orcConfigDescricao | placeholders: getPlaceholderVars()"
        id="docConfigDescricao"
      ></p>
      <p>
        Proposta para o per√≠odo de
        <span id="docPeriodo"
          >{{ dataCheckin | date: 'dd/MM/yyyy' }} a {{ dataCheckout | date: 'dd/MM/yyyy' }}</span
        >
        (<span id="docNoites">{{ calcularNoites(dataCheckin, dataCheckout) }}</span>
        <span id="labelDiaria">{{
          calcularNoites(dataCheckin, dataCheckout) === 1 ? 'di√°ria' : 'di√°rias'
        }}</span
        >):
      </p>
    </div>

    <!-- Tabela de valores -->
    <p-table [value]="itens" styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Qtd</th>
          <th>Acomoda√ß√£o</th>
          <th>Servi√ßos</th>
          <th>Vlr. Di√°ria</th>
          <th>Di√°rias</th>
          <th>Total</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.quantidade }}</td>
          <td>
            <strong>{{ item.categoriaNome }}</strong>
            <span class="text-500 text-xs">{{ item.camasDescricao }}</span>
            <div
              *ngIf="item.descricao"
              class="text-500"
              style="font-size: 10px; font-style: italic"
            >
              {{ item.descricao }}
            </div>
          </td>
          <td>
            <span *ngIf="item.comCafe">Caf√©</span>
            <span *ngIf="item.comAlmoco && item.qtdAlmoco">
              + {{ item.qtdAlmoco }} Almo√ßo{{ item.qtdAlmoco > 1 ? 's' : '' }}</span
            >
            <span *ngIf="item.comJanta && item.qtdJanta">
              + {{ item.qtdJanta }} Janta{{ item.qtdJanta > 1 ? 's' : '' }}</span
            >
            <span *ngIf="item.comLanche && item.qtdLanche">
              + {{ item.qtdLanche }} Lanche{{ item.qtdLanche > 1 ? 's' : '' }}</span
            >
          </td>
          <td>{{ item.precoDiaria | currency: 'BRL' }}</td>
          <td>
            <span *ngIf="item._subtotalSemExtra != null">
              {{ item._subtotalSemExtra | currency: 'BRL' }}
            </span>
            <span *ngIf="item._extraCharge && item._extraCharge > 0" class="block text-red-500">
              + {{ item._extraCharge | currency: 'BRL' }} ({{ horasExtras | number: '1.0-0' }}h
              extra)
            </span>
          </td>
          <td>{{ item._totalItem | currency: 'BRL' }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="footer">
        <tr *ngIf="config.orcNotaRefeicoes">
          <td
            colspan="6"
            class="text-italic p-2"
            [innerHTML]="config.orcNotaRefeicoes | placeholders: getPlaceholderVars()"
          ></td>
        </tr>
        <tr class="font-bold">
          <td colspan="5" class="text-right">VALOR TOTAL:</td>
          <td>{{ totalGeral | currency: 'BRL' }}</td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Se√ß√µes din√¢micas -->
    <div class="mt-3 text-sm">
      <h2>2. Cronograma de Estadia e Log√≠stica:</h2>
      <p [innerHTML]="config.orcCronograma | placeholders: getPlaceholderVars()"></p>
      <h2>3.Condi√ß√µes de Pagamento e Prazos:</h2>
      <p [innerHTML]="config.orcPagamento | placeholders: getPlaceholderVars()"></p>
      <h2>4. Observa√ß√µes Gerais:</h2>
      <p [innerHTML]="config.orcObservacoes | placeholders: getPlaceholderVars()"></p>
    </div>

    <!-- Rodap√© de assinaturas -->
    <div class="flex justify-content-between mt-4">
      <div
        class="text-center border-top-1 surface-border pt-2 w-5"
        [innerHTML]="config.orcRodape | placeholders: getPlaceholderVars()"
      ></div>
      <div class="text-center border-top-1 surface-border pt-2 w-5">
        Aceite do Cliente (Carimbo e Assinatura)
      </div>
    </div>
  </div>

  <!-- Bot√£o Imprimir -->
  <div class="flex justify-content-center mt-3 no-print">
    <p-button
      label="Imprimir / Gerar PDF"
      icon="pi pi-print"
      styleClass="p-button-success p-button-raised"
      (click)="imprimir()"
    ></p-button>
  </div>
</div>
