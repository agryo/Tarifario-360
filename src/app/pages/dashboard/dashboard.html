<!-- Toast para mensagens -->
<p-toast position="top-center"></p-toast>

<p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>

<div class="dashboard">
  <!-- Cabe√ßalho com sauda√ß√£o e bot√µes -->
  <div class="flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="text-3xl font-bold">üè® Tarif√°rio 360</h1>
      <p class="text-secondary">Sistema de Gest√£o Hoteleira</p>
    </div>
    <div class="flex align-items-center gap-2">
      <!-- Theme Toggle -->
      <app-theme-toggle></app-theme-toggle>

      <!-- Bot√£o Configura√ß√µes -->
      <p-button
        label="Configura√ß√µes"
        icon="pi pi-cog"
        styleClass="p-button-help p-button-raised"
        (click)="abrirConfiguracoes()"
      >
      </p-button>
    </div>
  </div>

  <!-- Cards de resumo (sempre vis√≠veis) -->
  <div class="grid mb-4">
    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="dashboard-card">
        <div class="flex align-items-center gap-3">
          <div class="card-icon bg-primary">
            <i class="pi pi-tag"></i>
          </div>
          <div>
            <span class="text-secondary block">Categorias</span>
            <span class="text-3xl font-bold">{{ totalCategorias }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="dashboard-card">
        <div class="flex align-items-center gap-3">
          <div class="card-icon bg-success">
            <i class="pi pi-percentage"></i>
          </div>
          <div>
            <span class="text-secondary block">Promo√ß√µes</span>
            <span class="text-3xl font-bold">{{ config.promocaoAtiva ? 'Sim' : 'N√£o' }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="dashboard-card">
        <div class="flex align-items-center gap-3">
          <div class="card-icon bg-warning">
            <i class="pi pi-bolt"></i>
          </div>
          <div>
            <span class="text-secondary block">kWh</span>
            <span class="text-3xl font-bold">{{ config.valorKwh | currency: 'BRL' }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <div class="col-12 md:col-6 lg:col-3">
      <p-card styleClass="dashboard-card">
        <div class="flex align-items-center gap-3">
          <div class="card-icon bg-info">
            <i class="pi pi-coffee"></i>
          </div>
          <div>
            <span class="text-secondary block">Almo√ßo</span>
            <span class="text-3xl font-bold">{{ config.valorAlmocoExtra | currency: 'BRL' }}</span>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- √Årea de conte√∫do: Cards dos m√≥dulos ou m√≥dulo ativo -->
  <div *ngIf="!moduloAtivo; else moduloTemplate">
    <h2 class="text-2xl font-bold mb-3">M√≥dulos</h2>
    <div class="grid">
      <!-- Or√ßamento R√°pido -->
      <div class="col-12 md:col-6 lg:col-4">
        <p-card styleClass="module-card" header="‚ö° Or√ßamento R√°pido" subheader="WhatsApp">
          <p class="module-description">
            Gere or√ßamentos instant√¢neos com emojis para enviar pelo WhatsApp
          </p>
          <div class="module-features">
            <span><i class="pi pi-check-circle text-success mr-2"></i>Alta/Baixa autom√°tico</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Promo√ß√µes aplicadas</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>C√≥pia com formata√ß√£o</span>
          </div>
          <div class="flex justify-content-end mt-3">
            <p-button
              label="Acessar"
              icon="pi pi-whatsapp"
              styleClass="p-button-success"
              (click)="abrirModulo('orcamento-rapido')"
            ></p-button>
          </div>
        </p-card>
      </div>

      <!-- Tabela de Op√ß√µes -->
      <div class="col-12 md:col-6 lg:col-4">
        <p-card styleClass="module-card" header="üìã Tabela de Op√ß√µes" subheader="Comparativo">
          <p class="module-description">
            Compare m√∫ltiplas op√ß√µes de quartos para oferecer ao cliente
          </p>
          <div class="module-features">
            <span><i class="pi pi-check-circle text-success mr-2"></i>Filtros inteligentes</span>
            <span
              ><i class="pi pi-check-circle text-success mr-2"></i>Separa√ß√£o solteiro/casal</span
            >
            <span><i class="pi pi-check-circle text-success mr-2"></i>Com/sem caf√©</span>
          </div>
          <div class="flex justify-content-end mt-3">
            <p-button
              label="Acessar"
              icon="pi pi-table"
              styleClass="p-button-info"
              (click)="abrirModulo('tabela-opcoes')"
            ></p-button>
          </div>
        </p-card>
      </div>

      <!-- Or√ßamento Oficial -->
      <div class="col-12 md:col-6 lg:col-4">
        <p-card
          styleClass="module-card"
          header="üìÑ Or√ßamento Oficial"
          subheader="Propostas detalhadas"
        >
          <p class="module-description">Crie propostas formais para grupos, empresas e eventos</p>
          <div class="module-features">
            <span><i class="pi pi-check-circle text-success mr-2"></i>M√∫ltiplos itens</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Alimenta√ß√£o inclusa</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Exportar PDF</span>
          </div>
          <div class="flex justify-content-end mt-3">
            <p-button
              label="Acessar"
              icon="pi pi-file-pdf"
              styleClass="p-button-help"
              (click)="abrirModulo('orcamento-oficial')"
            ></p-button>
          </div>
        </p-card>
      </div>

      <!-- Tabela de Pre√ßos -->
      <div class="col-12 md:col-6 lg:col-4">
        <p-card styleClass="module-card" header="üìä Tabela de Pre√ßos" subheader="Visualiza√ß√£o">
          <p class="module-description">Visualize e imprima tabelas de pre√ßos por temporada</p>
          <div class="module-features">
            <span><i class="pi pi-check-circle text-success mr-2"></i>Alta/Baixa temporada</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Agrupamento UHs</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Formato para impress√£o</span>
          </div>
          <div class="flex justify-content-end mt-3">
            <p-button
              label="Acessar"
              icon="pi pi-chart-bar"
              styleClass="p-button-warning"
              (click)="abrirModulo('tabela-precos')"
            ></p-button>
          </div>
        </p-card>
      </div>

      <!-- Calculadora Wallbox -->
      <div class="col-12 md:col-6 lg:col-4">
        <p-card
          styleClass="module-card"
          header="üîå Calculadora Wallbox"
          subheader="Recarga el√©trica"
        >
          <p class="module-description">Calcule o custo de recarga de ve√≠culos el√©tricos</p>
          <div class="module-features">
            <span><i class="pi pi-check-circle text-success mr-2"></i>kWh configur√°vel</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>C√°lculo autom√°tico</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Integra√ß√£o com tarifas</span>
          </div>
          <div class="flex justify-content-end mt-3">
            <p-button
              label="Acessar"
              icon="pi pi-bolt"
              styleClass="p-button-danger"
              (click)="abrirModulo('wallbox')"
            ></p-button>
          </div>
        </p-card>
      </div>

      <!-- Escala Noturna -->
      <div class="col-12 md:col-6 lg:col-4">
        <p-card styleClass="module-card" header="üåô Escala Noturna" subheader="Revezamento">
          <p class="module-description">
            Gere escala de trabalho noturno com dois funcion√°rios e folgas fixas
          </p>
          <div class="module-features">
            <span><i class="pi pi-check-circle text-success mr-2"></i>Revezamento autom√°tico</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Folgas configur√°veis</span>
            <span><i class="pi pi-check-circle text-success mr-2"></i>Imprimir / Exportar</span>
          </div>
          <div class="flex justify-content-end mt-3">
            <p-button
              label="Acessar"
              icon="pi pi-clock"
              styleClass="p-button-secondary"
              (click)="abrirModulo('escala-noturna')"
            ></p-button>
          </div>
        </p-card>
      </div>
    </div>
  </div>

  <ng-template #moduloTemplate>
    <div class="modulo-container">
      <ng-container [ngSwitch]="moduloAtivo">
        <app-orcamento-rapido
          *ngSwitchCase="'orcamento-rapido'"
          (onMensagem)="mostrarMensagem($event)"
          (onVoltar)="fecharModulo()"
        ></app-orcamento-rapido>
        <app-tabela-precos
          *ngSwitchCase="'tabela-precos'"
          (onVoltar)="fecharModulo()"
        ></app-tabela-precos>
        <app-tabela-opcoes
          *ngSwitchCase="'tabela-opcoes'"
          (onMensagem)="mostrarMensagem($event)"
          (onVoltar)="fecharModulo()"
        ></app-tabela-opcoes>
        <app-orcamento-oficial
          *ngSwitchCase="'orcamento-oficial'"
          (onMensagem)="mostrarMensagem($event)"
          (onVoltar)="fecharModulo()"
        ></app-orcamento-oficial>
        <app-wallbox
          *ngSwitchCase="'wallbox'"
          (onMensagem)="mostrarMensagem($event)"
          (onVoltar)="fecharModulo()"
        >
        </app-wallbox>
        <app-escala-noturna
          *ngSwitchCase="'escala-noturna'"
          (onMensagem)="mostrarMensagem($event)"
          (onVoltar)="fecharModulo()"
        ></app-escala-noturna>
        <!-- Outros m√≥dulos ser√£o adicionados futuramente -->
      </ng-container>
    </div>
  </ng-template>
</div>

<!-- DIALOG DE SENHA -->
<p-dialog
  [(visible)]="senhaDialogVisible"
  [style]="{ width: '400px' }"
  header="üîí Painel Protegido"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
>
  <ng-template pTemplate="content">
    <div class="p-fluid text-center">
      <i
        class="pi pi-lock"
        style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem"
      ></i>
      <p class="mb-3">Digite a senha mestra para acessar as configura√ß√µes:</p>

      <div class="field">
        <input
          type="password"
          pInputText
          [(ngModel)]="senhaInput"
          placeholder="Senha do sistema"
          class="w-full"
          (keyup.enter)="verificarSenha()"
          autofocus
        />
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-center gap-2">
      <p-button
        label="Cancelar"
        icon="pi pi-times"
        styleClass="p-button-text"
        (click)="senhaDialogVisible = false; senhaInput = ''"
      >
      </p-button>
      <p-button
        label="Entrar"
        icon="pi pi-check"
        styleClass="p-button-success"
        (click)="verificarSenha()"
      >
      </p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- MODAL DE CONFIGURA√á√ïES -->
<p-dialog
  [(visible)]="configDialogVisible"
  [style]="{ width: '1400px', maxHeight: '99vh' }"
  header="‚öôÔ∏è Painel Master - Configura√ß√µes Globais do Sistema"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  (onHide)="fecharConfiguracoes()"
>
  <ng-template pTemplate="content">
    <app-painel-master
      (onFechar)="fecharConfiguracoes()"
      (onSalvo)="carregarResumos()"
      (onMensagem)="mostrarMensagem($event)"
    ></app-painel-master>
  </ng-template>
</p-dialog>
